<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Carle</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .header {
            font-weight: bold;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            text-align: center;
        }

        .header-red {
            color: red;
        }

        .container {
            max-width: 90%;
        }

        .flex-container {
            display: flex;
            flex-direction: row;
            gap: 10px;
            text-align: center;
            justify-content: center;
        }

        #car-img-container {
            text-align: center;
            padding: 30px;
            width: 50%;
            background-color: whitesmoke;
            margin: 10px auto;
            border-radius: 10px;
        }

        #car-img {
            border-radius: 20px;
        }

        #answer-container {
            text-align: center;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            font-size: xx-large;
            color: lightgrey;
        }

        .flex-guess {
            display: flex;
            flex-direction: row;
            gap: 2px;
            align-items: center;
            text-align: center;
            justify-content: center;
            padding: 3px;
        }

        .flex-item {
            width: auto;
            background-color: whitesmoke;
            border-radius: 10px;
            padding: 10px;
        }

        .flex-letter {
            width: auto;
            color: white;
            border-radius: 3px;
            padding: 5px;
            font-weight: bold;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        .guess-tb {
            margin: 3px;
        }

        .guess-bt {
            background-color: crimson;
            border-radius: 5px;
            border-color: darkred;
            color: white;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        .guess-bt:disabled {
            background-color: darkred;
            color: grey;
        }

        .correct {
            background-color: green;
        }

        .incorrect {
            background-color: firebrick;
        }

        .curious {
            background-color: goldenrod;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="header"><span class="header-red">Car</span>le</h1>

        <div id="car-img-container">
            <img id="car-img" />
        </div>


        <div class="flex-container">
            <div id="make" class="flex-item">
                <h2 class="header">Make</h2>
                <div id="make-guess-container">

                </div>
                <input id="make-tb" class="guess-tb" type="text" />
                <button class="guess-bt" id="make-btn" onclick="MakeClick()" class="guess-tb">Guess</button>
            </div>
            <div id="model" class="flex-item">
                <h2 class="header">Model</h2>
                <div id="model-guess-container"></div>
                <input id="model-tb" class="guess-tb" type="text" />
                <button class="guess-bt" id="model-btn" onclick="ModelClick()" class="guess-tb">Guess</button>
            </div>
        </div>

        <div id="answer-container">
        </div>

    </div>

    <script>
        const FINISHED_EMOJI = "ðŸš—ðŸ’ª";
        const FAILURE_EMOJI = "ðŸ‘‰ðŸš²ðŸ‘ˆ";

        let makeGuesses = 4;
        let modelGuesses = 4;

        let makeCorrect = false;
        let modelCorrect = false;

        let makeTextBox = $("#make-tb");
        let modelTextBox = $("#model-tb");

        let makeButton = $("#make-btn");
        let modelButton = $("#model-btn");

        let makeGuessContainer = $("#make-guess-container");
        let modelGuessContainer = $("#model-guess-container");

        let answerContainer = $("#answer-container");

        let carImg = $("#car-img");

        let today = {
            make: "BUGATTI",
            model: "EB112",
            imgSource: "bugattieb112.png"
        }

        carImg.attr("src", today.imgSource);
        answerContainer.text(`${today.make} ${today.model}`);
        answerContainer.css("visibility", "hidden");

        function MakeClick() {
            let text = makeTextBox.val();

            if (!text)
                return;

            makeTextBox.val("");
            let upperCase = text.toUpperCase();

            let normalizedArray = [...upperCase];
            let correct = today.make;
            let flexGuess = GenerateDivs(correct, normalizedArray);
            makeGuessContainer.append(flexGuess);

            if (upperCase === today.make) {
                makeGuessContainer.append(GenerateFinished());
                makeButton.attr("disabled", true);
                makeCorrect = true;
            }

            MakeGuessDecrement();
            WinHandler();
        }

        function MakeGuessDecrement() {
            if (makeGuesses-- === 0) {
                makeButton.attr("disabled", true);
                makeGuessContainer.append(GenerateFailure());
                answerContainer.css("visibility", "visible");
                return true;
            }
            return false;
        }

        function ModelClick() {
            let text = modelTextBox.val();

            if (!text)
                return;

            modelTextBox.val("");
            let upperCase = text.toUpperCase();
            let normalizedArray = [...upperCase];

            let correct = today.model;
            let flexGuess = GenerateDivs(correct, normalizedArray);
            modelGuessContainer.append(flexGuess);

            if (upperCase === today.model) {
                modelGuessContainer.append(GenerateFinished());
                modelButton.attr("disabled", true);
                modelCorrect = true;
            }

            ModelGuessDecrement();
            WinHandler();
        }

        function ModelGuessDecrement() {
            if (modelGuesses-- === 0) {
                modelButton.attr("disabled", true);
                modelGuessContainer.append(GenerateFailure());
                answerContainer.css("visibility", "visible");
                return true;
            }
            return false;
        }

        function WinHandler() {
            if (makeCorrect && modelCorrect)
                answerContainer.css("visibility", "visible");
        }

        function GenerateDivs(correct, normalizedInputArray) {
            let flexGuess = GenerateFlexGuess();
            normalizedInputArray.forEach(letter => {
                let flexLetter;
                if (correct.includes(letter)) {
                    correct = correct.replace(letter, "");
                    flexLetter = GenerateFlexLetter(letter, "correct");
                }
                else {
                    flexLetter = GenerateFlexLetter(letter, "incorrect");
                }
                flexGuess.append(flexLetter);
            });
            // letters left to be used.
            if (correct.length > 0)
                flexGuess.append(GenerateFlexLetter("Â¿?", "curious"));
            return flexGuess;
        }

        function GenerateFlexGuess() {
            let flexGuess = $("<div></div>");
            flexGuess.addClass("flex-guess");
            return flexGuess;
        }

        function GenerateFlexLetter(letter, classType) {
            let flexLetter = $("<div></div>");
            flexLetter.text(letter);
            flexLetter.addClass("flex-letter");
            flexLetter.addClass(classType);
            return flexLetter;
        }

        function GenerateFinished() {
            return $(`<div style=\"font-size:x-large\">${FINISHED_EMOJI}<div>`);
        }

        function GenerateFailure() {
            return $(`<div style=\"font-size:x-large\">${FAILURE_EMOJI}</div>`);
        }
    </script>
</body>

</html>